{{- $styles := resources.Get "css/common.css" | minify | fingerprint -}} {{- $js
:= resources.Get "js/index.js" -}} {{- if $js -}} {{- $js = $js |
resources.ExecuteAsTemplate "js/index.js" . -}} {{- $js = $js | minify |
fingerprint -}} {{- end -}}{{- $indexStyle := resources.Get "css/index.css" |
minify | fingerprint -}}
<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>{{ .Title }}</title>
        <meta name="description" content="{{ .Description }}" />
        <meta name="keywords" content="{{ delimit .Params.keywords `, ` }}" />
        <meta name="author" content="{{ .Params.translator | default `` }}" />
        <meta name="robots" content="index, follow" />
        <link rel="canonical" href="{{ .Permalink }}" />
        <meta name="theme-color" content="#333333" />

        <link
            rel="icon"
            type="image/png"
            href="{{ `icons/favicon-96x96.png` | relURL }}"
            sizes="96x96"
        />
        <link
            rel="icon"
            type="image/svg+xml"
            href="{{ `assets/icons/favicon.svg` | relURL }}"
        />
        <link rel="shortcut icon" href="{{ `icons/favicon.ico` | relURL }}" />
        <link
            rel="apple-touch-icon"
            sizes="180x180"
            href="{{ `icons/apple-touch-icon.png` | relURL }}"
        />
        <meta
            name="apple-mobile-web-app-title"
            content="{{ .Params.short_name | default .Title }}"
        />
        {{ with .OutputFormats.Get "WebAppManifest" }}
        <link rel="manifest" href="{{ .Permalink }}" />
        {{ end }}

        <meta property="og:type" content="book" />
        <meta property="og:url" content="{{ .Permalink }}" />
        <meta property="og:title" content="{{ .Title }}" />
        <meta property="og:description" content="{{ .Description }}" />
        {{ with .Params.images }}
        <meta property="og:image" content="{{ index . 0 | relURL }}" />
        {{ end }}

        <meta property="twitter:card" content="summary_large_image" />
        <meta property="twitter:url" content="{{ .Permalink }}" />
        <meta property="twitter:title" content="{{ .Title }}" />
        <meta property="twitter:description" content="{{ .Description }}" />
        {{ with .Params.images }}
        <meta property="twitter:image" content="{{ index . 0 | relURL }}" />
        {{ end }}

        <link rel="preconnect" href="https://fonts.googleapis.com" />
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
        <link
            href="https://fonts.googleapis.com/css2?family=Open+Sans:ital,wght@0,300..800;1,300..800&display=swap"
            rel="stylesheet"
        />
        <link
            href="https://fonts.googleapis.com/css2?family=Baskervville:ital@0;1&family=Bitter:ital,wght@0,100..900;1,100..900&family=Caveat:wght@400..700&family=Coming+Soon&family=EB+Garamond:ital,wght@0,400..800;1,400..800&family=Fira+Mono:wght@400;500;700&family=Indie+Flower&family=Literata:ital,opsz,wght@0,7..72,200..900;1,7..72,200..900&family=Merriweather:ital,wght@0,300..900;1,300..900&family=Merriweather+Sans:ital,wght@0,300..800;1,300..800&family=Noto+Serif:ital,wght@0,100..900;1,100..900&family=Nunito+Sans:ital,opsz,wght@0,6..12,200..1000;1,6..12,200..1000&family=Patrick+Hand&display=swap"
            rel="stylesheet"
            media="print"
            onload="this.media = 'all'"
        />
        <noscript>
            <link
                href="https://fonts.googleapis.com/css2?family=Baskervville:ital@0;1&family=Bitter:ital,wght@0,100..900;1,100..900&family=Caveat:wght@400..700&family=Coming+Soon&family=EB+Garamond:ital,wght@0,400..800;1,400..800&family=Fira+Mono:wght@400;500;700&family=Indie+Flower&family=Literata:ital,opsz,wght@0,7..72,200..900;1,7..72,200..900&family=Merriweather:ital,wght@0,300..900;1,300..900&family=Merriweather+Sans:ital,wght@0,300..800;1,300..800&family=Noto+Serif:ital,wght@0,100..900;1,100..900&family=Nunito+Sans:ital,opsz,wght@0,6..12,200..1000;1,6..12,200..1000&family=Patrick+Hand&display=swap"
                rel="stylesheet"
            />
        </noscript>

        <link rel="stylesheet" href="{{ $styles.RelPermalink }}" />
        <link rel="stylesheet" href="{{ $indexStyle.RelPermalink }}" />

        <script>
            (function () {
                try {
                    var savedSettings = localStorage.getItem("reader-settings");
                    var theme = "light";

                    if (savedSettings) {
                        theme = JSON.parse(savedSettings).theme || "light";
                    }

                    const themes = {
                        light: { bg: "#fdfdfd", text: "#333333" },
                        sepia: { bg: "#f4ecd8", text: "#5b4636" },
                        dark: { bg: "#222222", text: "#d1d1d1" },
                        midnight: { bg: "#2b323b", text: "#c4cdd5" },
                        forest: { bg: "#e8f5e9", text: "#2d3b2d" },
                        amoled: { bg: "#000000", text: "#b3b3b3" },
                    };

                    var activeTheme = themes[theme] || themes.light;
                    var root = document.documentElement;

                    root.style.setProperty("--bg-color", activeTheme.bg);
                    root.style.setProperty("--text-color", activeTheme.text);

                    root.setAttribute("data-theme", theme);
                } catch (e) {
                    console.error("Theme initialization failed", e);
                }
            })();
        </script>
    </head>

    <body>
        <header class="book-header">
            <h1 class="book-title">{{ .Title }}</h1>
            <div class="book-meta">By {{ .Params.author }}</div>
            <div class="book-cover">
                {{ with .Params.images }}
                <img src="{{ index . 0 | relURL }}" alt="Book Cover" />
                {{ end }}
            </div>
            <div class="book-description" id="bookDescription">
                {{ .Content }}
            </div>

            <button id="toggleSynopsisBtn" class="synopsis-toggle-btn">
                Show More
            </button>

            <div class="book-credits">
                <div class="credit-item">
                    <span class="credit-label">Author</span>
                    <span class="credit-value">{{ .Params.author }}</span>
                </div>

                <div class="credit-item">
                    <span class="credit-label">Translator</span>
                    <span class="credit-value">{{ .Params.translator }}</span>
                </div>
            </div>

            <div class="book-links">
                <div class="book-links-inner">
                    {{ range $index, $element := .Params.links }}
                    <a href="{{ .url }}" target="_blank" class="book-link"
                        >{{ .name }}</a
                    >
                    {{ if ne (add $index 1) (len $.Params.links) }}
                    <span class="dot">&bull;</span>
                    {{ end }} {{ end }}
                </div>
            </div>
        </header>

        <div class="ui-panel action-panel">
            <a id="firstChapterBtn" class="ui-button action-btn" href="#"
                >First Chapter</a
            >
            <a
                id="resumeBtn"
                class="ui-button action-btn resume-hidden"
                href="#"
                aria-label="Resume Reading"
            >
                <div class="resume-icon">
                    <svg
                        width="24"
                        height="24"
                        viewBox="0 0 24 24"
                        fill="currentColor"
                        xmlns="http://www.w3.org/2000/svg"
                    >
                        <path
                            d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 14.5v-9l6 4.5-6 4.5z"
                        />
                    </svg>
                </div>
                <div class="resume-info">
                    <span class="resume-label">Continue Reading</span>
                    <span id="resumeChapterDisplay" class="resume-value"
                        >Loading...</span
                    >
                </div>
            </a>
            <a id="latestChapterBtn" class="ui-button action-btn" href="#"
                >Latest Chapter</a
            >
        </div>

        <div
            id="latestUpdatesPanel"
            class="ui-panel latest-updates-panel hidden-empty"
        >
            <div class="panel-header">Latest Updates</div>
            <div id="latestList" class="latest-list"></div>
        </div>

        <div class="ui-panel sticky-controls">
            <div class="search-box">
                <input
                    type="text"
                    id="searchInput"
                    class="control-input"
                    placeholder="Search chapter..."
                    aria-label="Search Chapters"
                />
            </div>
            <button id="sortBtn" class="ui-button">
                <span id="sortLabel">Oldest First</span>
                <svg
                    width="12"
                    height="12"
                    viewBox="0 0 24 24"
                    fill="currentColor"
                >
                    <path d="M7 10l5 5 5-5z" />
                </svg>
            </button>
        </div>

        <div id="toc-container">
            <ul class="chapter-list" id="chapterList"></ul>
        </div>

        <div class="fab-container" style="gap: 20px">
            <div
                style="
                    position: relative;
                    display: flex;
                    flex-direction: column;
                    align-items: flex-end;
                    pointer-events: none;
                "
            >
                <div
                    class="settings-menu"
                    id="installMenu"
                    style="
                        position: absolute;
                        bottom: 100%;
                        right: 0;
                        margin-bottom: 12px;
                        pointer-events: auto;
                    "
                >
                    <div class="setting-item">
                        <button
                            id="pwaInstallAction"
                            class="ui-button"
                            style="
                                width: 100%;
                                justify-content: left;
                                margin-bottom: 8px;
                            "
                        >
                            <svg
                                width="18"
                                height="18"
                                viewBox="0 0 24 24"
                                fill="currentColor"
                            >
                                <path
                                    d="M19 9h-4V3H9v6H5l7 7 7-7zM5 18v2h14v-2H5z"
                                />
                            </svg>
                            Add to Homepage
                        </button>
                        <button
                            id="pwaDismissAction"
                            class="ui-button"
                            style="
                                width: 100%;
                                justify-content: left;
                                opacity: 0.8;
                            "
                        >
                            <svg
                                width="18"
                                height="18"
                                viewBox="0 0 24 24"
                                fill="currentColor"
                            >
                                <path
                                    d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm5 11H7v-2h10v2z"
                                />
                            </svg>
                            Hide button forever
                        </button>
                    </div>
                </div>

                <button
                    class="settings-btn"
                    id="installFab"
                    aria-label="Install App"
                    style="display: none; pointer-events: auto"
                >
                    <svg viewBox="0 0 24 24" fill="currentColor">
                        <path d="M19 9h-4V3H9v6H5l7 7 7-7zM5 18v2h14v-2H5z" />
                    </svg>
                </button>
            </div>

            <div
                style="
                    position: relative;
                    display: flex;
                    flex-direction: column;
                    align-items: flex-end;
                    pointer-events: none;
                "
            >
                <div
                    class="settings-menu"
                    id="settingsMenu"
                    style="
                        position: absolute;
                        bottom: 100%;
                        right: 0;
                        margin-bottom: 12px;
                        pointer-events: auto;
                    "
                >
                    <div class="setting-item">
                        <div class="setting-header">
                            <label>Theme</label>
                        </div>
                        <div class="theme-selector">
                            <button
                                class="theme-btn"
                                data-theme="light"
                                style="background-color: #fdfdfd"
                                aria-label="Light"
                            ></button>
                            <button
                                class="theme-btn"
                                data-theme="sepia"
                                style="background-color: #f4ecd8"
                                aria-label="Sepia"
                            ></button>
                            <button
                                class="theme-btn"
                                data-theme="dark"
                                style="background-color: #222222"
                                aria-label="Dark"
                            ></button>
                            <button
                                class="theme-btn"
                                data-theme="midnight"
                                style="background-color: #2b323b"
                                aria-label="Midnight"
                            ></button>
                            <button
                                class="theme-btn"
                                data-theme="forest"
                                style="background-color: #e8f5e9"
                                aria-label="Forest"
                            ></button>
                            <button
                                class="theme-btn"
                                data-theme="amoled"
                                style="
                                    background-color: #000000;
                                    border: 1px solid #444;
                                "
                                aria-label="AMOLED"
                            ></button>
                        </div>
                    </div>
                </div>

                <button
                    class="settings-btn"
                    id="toggleSettings"
                    aria-label="Settings"
                    style="pointer-events: auto"
                >
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                        <path
                            d="M19.14,12.94c0.04-0.3,0.06-0.61,0.06-0.94c0-0.32-0.02-0.64-0.07-0.94l2.03-1.58c0.18-0.14,0.23-0.41,0.12-0.61 l-1.92-3.32c-0.12-0.22-0.37-0.29-0.59-0.22l-2.39,0.96c-0.5-0.38-1.03-0.7-1.62-0.94L14.4,2.81c-0.04-0.24-0.24-0.41-0.48-0.41 h-3.84c-0.24,0-0.43,0.17-0.47,0.41L9.25,5.35C8.66,5.59,8.12,5.92,7.63,6.29L5.24,5.33c-0.22-0.08-0.47,0-0.59,0.22L2.74,8.87 C2.62,9.08,2.66,9.34,2.86,9.48l2.03,1.58C4.84,11.36,4.8,11.69,4.8,12s0.02,0.64,0.07,0.94l-2.03,1.58 c-0.18,0.14-0.23,0.41-0.12,0.61l1.92,3.32c0.12,0.22,0.37,0.29,0.59,0.22l2.39-0.96c0.5,0.38,1.03,0.7,1.62,0.94l0.36,2.54 c0.05,0.24,0.24,0.41,0.48,0.41h3.84c0.24,0,0.44-0.17,0.47-0.41l0.36-2.54c0.59-0.24,1.13-0.56,1.62-0.94l2.39,0.96 c0.22,0.08,0.47,0,0.59-0.22l1.92-3.32c0.12-0.22,0.07-0.47-0.12-0.61L19.14,12.94z M12,15.6c-1.98,0-3.6-1.62-3.6-3.6 s1.62-3.6,3.6-3.6s3.6,1.62,3.6,3.6S13.98,15.6,12,15.6z"
                        />
                    </svg>
                </button>
            </div>
        </div>

        <script src="{{ $js.RelPermalink }}"></script>

        <script>
            function registerServiceWorker() {
                if ("serviceWorker" in navigator) {
                    window.addEventListener("load", () => {
                        navigator.serviceWorker
                            .register("{{ `sw.js` | relURL }}")
                            .then((reg) =>
                                console.log("Service Worker registered!", reg),
                            )
                            .catch((err) =>
                                console.log("Registration failed:", err),
                            );
                    });
                }
            }

            registerServiceWorker();
        </script>
    </body>
</html>
